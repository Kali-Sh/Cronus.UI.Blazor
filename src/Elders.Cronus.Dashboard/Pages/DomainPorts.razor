@page "/domain-ports"
@inject AppState App
@inject CronusClient Cronus
@inject IJSRuntime JSRuntime
@inject ILogger<DomainPorts> Log

<h2 class="mat-h2">Ports</h2>

<div class="mat-layout-grid">

    <MatTable Items="@Domain?.Ports" LoadInitialData="true" FilterByColumnName="Name" PageSize="9999" ShowPaging="false" Striped="false" AllowSelection="true" SelectionChanged="SelectionChangedEvent" class="mat-elevation-z5">
        <MatTableHeader>
            <th>Name</th>
            <th>ID</th>
        </MatTableHeader>
        <MatTableRow>
            <td>@context.Name</td>
            <td>@context.Id</td>
        </MatTableRow>
    </MatTable>

    <div class="mat-layout-grid-inner">
        <div class="mat-layout-grid-cell mat-layout-grid-cell-span-6">
            <h3 class="mat-h3">@Port?.Name Events</h3>
            <MatTable Items="@Port?.Events" LoadInitialData="true" FilterByColumnName="Name" PageSize="9999" ShowPaging="false" Striped="false" AllowSelection="true" class="mat-elevation-z5">
                <MatTableHeader>
                    <th>Name</th>
                    <th>ID</th>
                    <th>Actions</th>
                </MatTableHeader>
                <MatTableRow>
                    <td>@context.Name</td>
                    <td><i>@context.Id</i></td>
                    <td>
                        <MatButton Outlined="true" TrailingIcon="delete" OnClick="@(async () => await OnGG())">Request all public event</MatButton>
                    </td>
                </MatTableRow>
            </MatTable>
        </div>
    </div>
</div>

@code {
    DomainDto Domain { get; set; }

    DomainPortDto Port { get; set; }

    protected override async Task OnInitializedAsync()
    {
        Domain = await Cronus.GetDomainAsync(@App.Connection);
    }

    public void SelectionChangedEvent(object row)
    {
        Log.LogInformation("SelectionChangedEvent");

        if (row != null)
        {
            Log.LogInformation("row found");
            Port = (DomainPortDto)row;
            Log.LogInformation("row casted");
        }

        this.StateHasChanged();
    }

    protected async Task OnGG()
    {
        Log.LogInformation("GG");

        StateHasChanged();
    }
}
